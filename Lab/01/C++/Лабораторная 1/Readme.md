https://openweathermap.org/city/693805
e77a594c893b3114f6e35c0c3aab4509 API KEY
api.openweathermap.org/data/2.5/weather?q={city name}&appid={API key}
http://api.openweathermap.org/data/2.5/weather?q=Simferopol&appid=e77a594c893b3114f6e35c0c3aab4509
{"coord":{"lon":34.11,"lat":44.96},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"base":"stations","main":{"temp":274.84,"feels_like":270.7,"temp_min":274.84,"temp_max":274.84,"pressure":1031,"humidity":78,"sea_level":1031,"grnd_level":1000},"visibility":10000,"wind":{"speed":2.73,"deg":293},"clouds":{"all":0},"dt":1606053070,"sys":{"country":"UA","sunrise":1606020651,"sunset":1606054142},"timezone":10800,"id":693805,"name":"Simferopol","cod":200}
http://api.openweathermap.org/data/2.5/onecall?lat={lat}&lon={lon}&units={units}
http://api.openweathermap.org/data/2.5/onecall?lat=44.96&lon=34.11&units=metric&appid=e77a594c893b3114f6e35c0c3aab4509
 http://openweathermap.org/ и http://worldtimeapi.org



МИНИСТЕРСТВО НАУКИ И ВЫСШЕГО ОБРАЗОВАНИЯ РОССИЙСКОЙ ФЕДЕРАЦИИ
Федеральное государственное автономное образовательное учреждение высшего образования
"КРЫМСКИЙ ФЕДЕРАЛЬНЫЙ УНИВЕРСИТЕТ им. В. И. ВЕРНАДСКОГО"
ФИЗИКО-ТЕХНИЧЕСКИЙ ИНСТИТУТ
Кафедра компьютерной инженерии и моделирования


Отчёт по лабораторной работе № 1
по дисциплине "Программирование"


студента 1 курса группы ПИ-б-о-202(1)
Нестеренко Никиты Сергеевича
направления подготовки 09.03.04 "Программная инженерия"



Научный руководитель
старший преподаватель кафедры
компьютерной инженерии и моделирования	(оценка)	Чабанов В.В.


Симферополь, 2020

Цель:
Закрепить навыки разработки многофайловыx приложений;
Изучить способы работы с API web-сервиса;
Изучить процесс сериализации/десериализации данных в/из json;
Получить базовое представление о сетевом взаимодействии приложений;
Постановка задачи
Разработать сервис предоставляющий данные о погоде в городе Симферополе на момент запроса. В качестве источника данных о погоде использовать: http://openweathermap.org/. В состав сервиса входит: серверное приложение на языке С++ и клиентское приложение на языке Python. Серверное приложение (далее Сервер) предназначенное для обслуживания клиентских приложений и минимизации количества запросов к сервису openweathermap.org. Сервер должен обеспечивать возможность получения данных в формате JSON и виде html виджета (для вставки виджета на страницу будет использоваться iframe). Клиентское приложение должно иметь графический интерфейс отображающий сведения о погоде и возможность обновления данных по требованию пользователя.

Выполнение работы
1.Для начала был зарегистрирован аккаунт openwheatermap.org. API ключ по-умолчанию созданный сервисом: e77a594c893b3114f6e35c0c3aab4509.

скрин +++++++++++++

Затем были произведены несколько тестовых запросов, чтобы убедиться, что они не имеют ошибок и вывод правилен.

Запрос, созданный к серверу погоды включает в себя широту и долготу места, для которого необходимо получить погоду, исключить все типы прогноза кроме почасового, ключ API, метрические единицы изменения (цельсий) и описание на русском языке:

api.openweathermap.org/data/2.5/onecall?lat=45.0522222222&lon=33.9744444444&exclude=current,minutely,daily,alerts&appid=e77a594c893b3114f6e35c0c3aab4509&units=metric&lang=ru

Запрос для сервера погоды включает в себя город, время которого необходимо получить:

http://api.openweathermap.org/data/2.5/weather?q=Simferopol&appid=e77a594c893b3114f6e35c0c3aab4509

Исходный код сервера:

2.Подготовка к работе с сервисом worldtimeapi.org.

Сервис позволяет получить время в формате json. Составим запрос для получения времени в Симферополе и изучите формат ответа: http://worldtimeapi.org/pages/schema.

3.Подготовка серверного приложения.

Для работы с сетью используем библиотеку: https://github.com/yhirose/cpp-httplib.

Клонируем  в виде архива репозиторий библиотеки https://github.com/yhirose/cpp-httplib;

Создаем консольный C++ проект;

Перейдем в папку с главным .cpp файлом проекта и создайте папку include. В ней будут размещаться заголовочные файлы библиотек.

В папке include создаем папку cpp_httplib и скопируем туда файл httplib.h из скаченного ранее репозитория.

Перейдем в свойства проекта. Справа в разделе Дополнительные каталоги включаемых файлов добавим путь к каталогу include;

Скопируем и вставим в главный .cpp файл  код под назаванием "Server": 

```cpp
#include <iostream>
#include <cpp_httplib/httplib.h>
using namespace httplib;
 
// В этой функции формируем ответ сервера на запрос
void gen_response(const Request& req, Response& res) {
  // Команда set_content задаёт ответ сервера и тип ответа:
  // Hello, World! - тело ответа
  // text/plain - MIME тип ответа (в данном случае обычный текст)
  res.set_content("Hello, World!", "text/plain");
}
 
int main(){
  Server svr;                    // Создаём сервер (пока-что не запущен)
  svr.Get("/", gen_response);    // Вызвать функцию gen_response если кто-то обратиться к корню "сайта"
  std::cout << "Start server... OK\n";
  svr.listen("localhost", 1234); // Запускаем сервер на localhost и порту 1234
}
```

Запустим программу и перейдем по ссылке: http://localhost:1234/. Мы видем сообщение  "Hello, World!". Скриншот +++++++++++++

В этом примере я отправляю get-запрос по адресу http://worldtimeapi.org/api/timezone/Europe/Simferopol. 

Скриншот +++++++

Изучаем алгоритм работы серверного приложения.Создаем свой собственный сервер.

Исходный код MyServer: Код +++++++++++++

Запускаем сервер и перейдя по ссылке http://localhost:3000/ мы получим желаемый результат. Скринщот ++++++++++++

Для проверки  приходит ли  запрос на "/raw", сервер формирует и отправляет json: Скриншот +++++++++++++

4.Подготовка клиентского приложения.

Графический интерфейс реализуйте при помощи Tkinter стандартного модуля Python. 

Для выполнения лабораторной работы достаточно будет использовать  умения базового создания текстовых меток, компоновки виджетов и привязки событий мышки.

Исходный код клиента: Код ++++++++++++++++

Запустив программу мы перейдя по ссылке https://vladimirchabanov.github.io/Lab1_fils/widget.html сможем увидеть: Скриншот ++++++++

5.Туннель.

Скачаем программу и распакуем ее  в любое место.

Запустим. Откроется окно командной строки.Где мы вводим команду: ngrok.exe http 3000

Когда программа запустится по ссылке указанной в Forwarding наш сервер будет доступен из интернета.

Если прописать в браузере http://127.0.0.1:4040 мы увидем статистику по запросам проходящим через туннель. Скриншот ++++++

6.Вывод.
 
Цель работы была успешно достигнута. Было выполнено:

Создание сервера на языке С++, обращающегося к openweathermap.com и возвращающий виджет или описание и температуру в формате json.

Приложение с графическим интерфейсом, написанное на языке Python с использованием библиотеки Tkinter, получающее и обрабатывающее данные из сервера.


